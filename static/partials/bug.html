<div class="titlearea">
    <form ng-submit="submitTitle()" class="form-inline">
        {{bug.id}} -
        <span class="title" ng-hide="editingTitle" ng-click="editTitle()">{{bug.title}}
            <i class="icon-pencil"></i>
        </span>
        <input class="title-input" ng-show="editingTitle" name="titleInput" ng-model="bug.title">
        <input class="btn btn-medium" ng-show="editingTitle" type="submit" value="OK">
    </form>
</div>

<div class="subs">
  <a title="Click to stop watching this bug" ng-show="subscribed" ng-click="unsubscribe()">
    <i class="icon-star"></i>
  </a>
  <a title="Click to watch this bug."  ng-hide="subscribed" ng-click="subscribe()">
    <i class="icon-star-empty"></i>
  </a>
  ({{subcount}})
</div>

<cb-markdown ng-model="$parent.bug.description">No Description</cb-markdown>

<p>
  Filed {{bug.created_at | calDate}} by
  <img ng-src="http://www.gravatar.com/avatar/{{bug.creator.md5}}?s=16">
  {{bug.creator.email}}.
</p>

<p>
<form class="form-inline">
    Status:
    <select class="status" ng-model="bug.status" ng-options="state for state in allStates">
    </select>
</form>
<div class="tags">
    <form class="form-inline">
        Tags:
        <div class="btn-group" ng-repeat="tag in bug.tags">
            <button class="tag btn btn-mini btn-success" ng-click="listTag(tag)">{{tag}}</button>
            <button class="btn btn-mini btn-danger" ng-click="killTag(tag)">
                <i class="icon-white icon-remove"></i>
            </button>
        </div>
        <input type="text" id="tagbox" ui-keypress="{'enter space':'addTags($event)'}" ng-model="newtag" class="input-small"/>
    </form>
</div>
</p>

<p>
<div>
  <form class="form-horizontal" ng-submit="submitOwner()">
    <label ng-click="editOwner()">Assigned to

      <span ng-hide="editingowner">
        <span ng-show="bug.owner">
          <img ng-src="http://www.gravatar.com/avatar/{{bug.owner.md5}}?s=16">
          {{bug.owner.email}}
        </span>
        <span ng-hide="bug.owner"><em>nobody</em></span>
        <i class="icon-pencil"></i>
      </span>

      <input ng-show="editingowner" type="text" ng-model-instant="bug.owner.email" class="ownerbox input-medium">
      <button ng-show="editingowner" type="submit" class="btn">Save</button>
    </label>
  </form>
  <a ng-click="setOwnerToMe()">Assign to me</a>
</div>
</p>

<h3>Comments</h3>
<div class="comments">
  <div class="comment well well-small" ng-repeat="comment in comments">
    <div ng-hide="comment.deleted">
      <div class="author">
        <img ng-src="http://www.gravatar.com/avatar/{{comment.user.md5}}?s=16">
        {{comment.user.email}} commented {{comment.created_at | relDate}}
        <button ng-click="deleteComment(comment)" ng-show="comment.mine" 
                class="btn btn-mini pull-right">
          <i class="icon-trash"></i>
        </button>
      </div>
      <div class="comment-text" ng-bind-html-unsafe="comment.text | markdownify">
      </div>
    </div>
    <div ng-show="comment.deleted">
      <em class="muted">This comment has been deleted</em>
      <button ng-click="unDeleteComment(comment)" ng-show="comment.mine"
              class="btn btn-mini pull-right">
        <i class="icon-eye-open"></i>
      </button>
    </div>
  </div>
</div>
<button ng-hide="addingcomment" ng-click="startComment()" ng-show="loggedin" class="btn">Add Comment</button>
<div ng-show="addingcomment">
  <cb-markdown modeflag="editingcomment" ng-model="$parent.draftcomment"
  edit="true" savetext="Preview" clearfn="clearCommentDraft"></cb-markdown>
  <button ng-hide="editingcomment" ng-click="postComment()"
    class="btn btn-success pull-right">Post Comment</button>
</div>

<h3>History</h3>
<ul class="unstyled">
    <li ng-repeat="hi in history">
    <span ng-show="hi.ModInfo.by">
      <img ng-src="http://www.gravatar.com/avatar/{{hi.ModInfo.by.md5}}?s=16">
      {{hi.ModInfo.by.email}}
    </span>
    <span ng-hide="hi.ModInfo.by"><em>somebody</em></span>
    changed
    <span ng-show="hi.ModInfo.type"><tt>{{hi.ModInfo.type}}</tt></span>
    <span ng-hide="hi.ModInfo.type">(unknown)</span>
    {{hi.Timestamp | relDate}}
    </li>
</ul>
